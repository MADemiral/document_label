<div class="file-search-container">
  
  <!-- Search Section - ADD THIS BACK -->
  <div class="search-section">
    <div class="search-bar-container">
      <div class="search-input-wrapper">
        <input
          type="text"
          class="search-input"
          [placeholder]="placeholder"
          [value]="searchQuery()"
          (input)="onSearchInput($event)"
          (focus)="onInputFocus()"
          (blur)="onInputBlur()"
          (keydown)="onSearchKeyDown($event)"
        />
        <button 
          class="search-btn"
          (click)="performManualSearch()"
          [disabled]="isSearching()"
          title="Ara">
          <i class="fas fa-search" *ngIf="!isSearching()"></i>
          <i class="fas fa-spinner fa-spin" *ngIf="isSearching()"></i>
        </button>
        <button 
          class="clear-btn"
          *ngIf="searchQuery()"
          (click)="clearSearch()"
          title="Temizle">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Character Hint -->
      <div class="character-hint" *ngIf="showCharacterHint()">
        <i class="fas fa-info-circle"></i>
        {{ getCharacterHintText() }}
      </div>

      <!-- Suggestions Dropdown -->
      <div class="suggestions-dropdown" *ngIf="showSuggestions()">
        <div class="suggestions-header">
          <i class="fas fa-tags"></i>
          <span>Etiket Önerileri</span>
          <span class="suggestions-count">({{ suggestions().length }})</span>
        </div>
        <div class="suggestions-list">
          <div 
            class="suggestion-item"
            *ngFor="let suggestion of suggestions(); let i = index"
            [class.active]="i === activeSuggestionIndex()"
            (click)="selectSuggestion(suggestion)"
            (mouseenter)="activeSuggestionIndex.set(i)">
            <div class="suggestion-content">
              <i class="fas fa-tag"></i>
              <span class="suggestion-name" [innerHTML]="highlightMatch(suggestion.name, searchQuery())"></span>
             
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Type Selector -->
    <div class="search-type-selector" *ngIf="enableAdvancedSearch">
      <label for="search-type">Arama Tipi:</label>
      <select 
        id="search-type"
        class="search-type-select"
        [value]="searchType()"
        (change)="onSearchTypeChange($event)">
     
        <option value="semantic">Anlamsal</option>
        <option value="label">Etiket</option>
      </select>
    </div>

    <!-- Advanced Filters Toggle -->
    <button 
      class="advanced-filters-toggle"
      *ngIf="enableAdvancedSearch"
      (click)="toggleAdvancedFilters()"
      [class.active]="showAdvancedFilters()">
      <i class="fas fa-filter"></i>
      Gelişmiş Filtreler
      <i class="fas fa-chevron-down" [class.rotated]="showAdvancedFilters()"></i>
    </button>

    <!-- Advanced Filters Panel -->
    <div class="advanced-filters-panel" *ngIf="showAdvancedFilters()">
      <div class="filters-grid">
        <div class="filter-group">
          <label for="file-type">Dosya Tipi:</label>
          <select 
            id="file-type"
            class="filter-select"
            [value]="selectedFileType()"
            (change)="onFileTypeChange($event)">
            <option value="all">Tümü</option>
            <option *ngFor="let type of fileTypes.slice(1)" [value]="type">
              {{ type.toUpperCase() }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label for="category">Kategori:</label>
          <select 
            id="category"
            class="filter-select"
            [value]="selectedCategory()"
            (change)="onCategoryChange($event)">
            <option value="all">Tümü</option>
            <option *ngFor="let category of categories().slice(1)" [value]="category">
              {{ category }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label for="start-date">Başlangıç Tarihi:</label>
          <input 
            id="start-date"
            type="date"
            class="filter-input"
            [value]="getStartDateValue()"
            (change)="onStartDateChange($event)">
        </div>

        <div class="filter-group">
          <label for="end-date">Bitiş Tarihi:</label>
          <input 
            id="end-date"
            type="date"
            class="filter-input"
            [value]="getEndDateValue()"
            (change)="onEndDateChange($event)">
        </div>
      </div>

      <div class="filters-actions">
        <button 
          class="clear-filters-btn"
          (click)="clearFilters()"
          [disabled]="!hasActiveFilters()">
          <i class="fas fa-eraser"></i>
          Filtreleri Temizle
        </button>
      </div>
    </div>
  </div>

  <!-- Search Results Header -->
  <div class="results-header" *ngIf="totalResults() > 0">
    <div class="results-info">
      <h3>
        <i class="fas fa-search"></i>
        Arama Sonuçları
      </h3>
      <div class="results-stats">
        <span class="result-count">
          <strong>{{ totalResults() }}</strong> döküman bulundu
        </span>
        <span class="search-time" *ngIf="searchTime() > 0">
          <i class="fas fa-clock"></i>
          {{ searchTime() }}ms
        </span>
        <span class="search-type-info" *ngIf="searchQuery()">
          <i class="fas fa-info-circle"></i>
          {{ getSearchTypeText() }} arama
        </span>
      </div>
    </div>

    <!-- View Controls -->
    <div class="view-controls">
      <!-- View Mode Buttons -->
      <div class="view-mode-buttons">
        <button 
          class="view-mode-btn"
          [class.active]="viewMode() === 'cards'"
          (click)="setViewMode('cards')"
          title="Kart görünümü">
          <i class="fas fa-th-large"></i>
        </button>
        <button 
          class="view-mode-btn"
          [class.active]="viewMode() === 'grid'"
          (click)="setViewMode('grid')"
          title="Izgara görünümü">
          <i class="fas fa-th"></i>
        </button>
        <button 
          class="view-mode-btn"
          [class.active]="viewMode() === 'list'"
          (click)="setViewMode('list')"
          title="Liste görünümü">
          <i class="fas fa-list"></i>
        </button>
      </div>

      <!-- Sort Controls -->
      <div class="sort-controls">
        <select 
          class="sort-select"
          [value]="sortBy()"
          (change)="onSortByChange($event)">
          <option value="relevance">Uygunluk</option>
          <option value="date">Tarih</option>
          <option value="name">İsim</option>
          <option value="size">Boyut</option>
        </select>
        
        <button 
          class="sort-order-btn"
          (click)="toggleSortOrder()"
          [title]="sortOrder() === 'asc' ? 'Artan sıralama' : 'Azalan sıralama'">
          <i [class]="getSortIcon()"></i>
        </button>
      </div>

      <!-- Preview Toggle -->
      <button 
        class="preview-toggle-btn"
        [class.active]="showPreview()"
        (click)="togglePreview()"
        title="Önizleme">
        <i class="fas fa-eye"></i>
      </button>
    </div>
  </div>

  <!-- Search Results Container -->
  <div class="search-results-container" *ngIf="!isSearching() && totalResults() > 0">
    
    <!-- Cards View -->
    <div class="results-cards-view" *ngIf="viewMode() === 'cards'">
      <div class="document-cards-grid">
        <div 
          class="document-card"
          *ngFor="let document of documents(); trackBy: trackByDocumentId"
          [class.has-score]="document.score"
          (click)="openDocumentView(document)">
          
          <!-- Card Content -->
          <div class="card-header">
            <div class="file-icon">
              <i [class]="getDocumentIcon(document)"></i>
            </div>
            <div class="document-info">
              <h4 class="document-title" [title]="document.summary">
                {{ document.title }}
              </h4>
              <div class="document-meta">
                <span class="document-id">ID: {{ document.document_id }}</span>
                <span class="content-stats">{{ getContentStats(document) }}</span>
              </div>
            </div>
            <div class="score-badge" *ngIf="document.score" [class]="getScoreClass(document.score)">
              {{ (document.score * 100).toFixed(0) }}%
            </div>
          </div>

          <!-- Preview Content -->
          <div class="card-preview" *ngIf="showPreview()">
            <div class="summary-preview" *ngIf="document.summary">
              <p [innerHTML]="getTruncatedSummary(document)"></p>
            </div>
            <div class="content-preview" *ngIf="!document.summary && document.content">
              <p [innerHTML]="getTruncatedContent(document)"></p>
            </div>
          </div>

          <!-- Labels -->
          <div class="card-labels" *ngIf="document.labels?.length > 0">
            <span 
              class="label-tag"
              *ngFor="let labelName of getVisibleLabels(document); let i = index"
              [class.highlighted]="isLabelHighlighted(labelName)"
              (click)="onLabelClick(labelName, $event)">
              <i class="fas fa-tag"></i>
              {{ labelName }}
            </span>
            <span class="more-labels" *ngIf="document.labels.length > 3">
              +{{ document.labels.length - 3 }} daha
            </span>
          </div>

          <!-- Card Footer -->
          <div class="card-footer">
            <div class="footer-info">
              <span class="created-date" *ngIf="document.created_at">
                <i class="fas fa-calendar"></i>
                {{ formatDate(document.created_at) }}
              </span>
              <span class="search-type" *ngIf="document.search_type">
                <i class="fas fa-search"></i>
                {{ getSearchTypeText() }}
              </span>
            </div>
            
            <div class="quick-actions">
              <button 
                class="quick-action-btn"
                (click)="openDocumentView(document); $event.stopPropagation()"
                title="Görüntüle">
                <i class="fas fa-eye"></i>
              </button>
              <button 
                class="quick-action-btn"
                (click)="copyDocumentContent(document); $event.stopPropagation()"
                title="Kopyala">
                <i class="fas fa-copy"></i>
              </button>
              <button 
                class="quick-action-btn"
                (click)="shareDocument(document); $event.stopPropagation()"
                title="Paylaş">
                <i class="fas fa-share-alt"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- List View -->
    <div class="results-list-view" *ngIf="viewMode() === 'list'">
      <div class="document-list">
        <div 
          class="document-list-item"
          *ngFor="let document of documents(); trackBy: trackByDocumentId"
          (click)="openDocumentView(document)">
          
          <div class="list-item-content">
            <div class="item-icon">
              <i [class]="getDocumentIcon(document)"></i>
            </div>
            
            <div class="item-details">
              <h4 class="item-title">{{ document.title }}</h4>
              <p class="item-summary" *ngIf="document.summary" [innerHTML]="getTruncatedSummary(document)"></p>
              <div class="item-meta">
                <span>ID: {{ document.document_id }}</span>
                <span>{{ getContentStats(document) }}</span>
                <span *ngIf="document.created_at">{{ formatDate(document.created_at) }}</span>
              </div>
            </div>
            
            <div class="item-labels" *ngIf="document.labels?.length > 0">
              <span 
                class="label-mini"
                *ngFor="let label of getVisibleLabels(document)"
                [class.highlighted]="isLabelHighlighted(label)">
                {{ label }}
              </span>
            </div>
            
            <div class="item-actions">
              <div class="score-mini" *ngIf="document.score" [class]="getScoreClass(document.score)">
                {{ (document.score * 100).toFixed(0) }}%
              </div>
              <button 
                class="list-action-btn"
                (click)="openDocumentView(document); $event.stopPropagation()"
                title="Aç">
                <i class="fas fa-external-link-alt"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Grid View -->
    <div class="results-grid-view" *ngIf="viewMode() === 'grid'">
      <div class="document-grid">
        <div 
          class="document-grid-item"
          *ngFor="let document of documents(); trackBy: trackByDocumentId"
          (click)="openDocumentView(document)">
          
          <div class="grid-item-icon">
            <i [class]="getDocumentIcon(document)"></i>
          </div>
          
          <div class="grid-item-title">{{ document.title }}</div>
          
          <div class="grid-item-info">
            <span>{{ getContentStats(document) }}</span>
            <div class="score-mini" *ngIf="document.score" [class]="getScoreClass(document.score)">
              {{ (document.score * 100).toFixed(0) }}%
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isSearching()">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Dökümanlar aranıyor...</p>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isSearching() && totalResults() === 0 && searchQuery()">
    <div class="empty-content">
      <i class="fas fa-search"></i>
      <h3>Sonuç bulunamadı</h3>
      <p>"{{ searchQuery() }}" için hiçbir döküman bulunamadı.</p>
      <button class="clear-search-btn" (click)="clearSearch()">
        <i class="fas fa-times"></i>
        Aramayı temizle
      </button>
    </div>
  </div>

  <!-- Success/Error Messages -->
  <div class="message-container">
    <div class="success-message" *ngIf="saveSuccess()">
      {{ saveSuccess() }}
    </div>
    <div class="error-message" *ngIf="saveError()">
      {{ saveError() }}
    </div>
  </div>
</div>

<!-- FILE VIEW MODAL -->
<div class="file-view-overlay" *ngIf="showFileView()" (click)="closeFileView()">
  <div class="file-view-modal" (click)="$event.stopPropagation()">
    <app-file-view
      [document]="selectedDocument()!"
      [isModal]="isFileViewModal()"
      [searchQuery]="searchQuery()"
      (closeView)="closeFileView()"
      (editDocument)="onFileViewEditDocument($event)"
      (deleteDocument)="onFileViewDeleteDocument($event)"
      (downloadDocument)="onFileViewDownloadDocument($event)"
      (shareDocument)="onFileViewShareDocument($event)"
      (labelClick)="onFileViewLabelClick($event)">
    </app-file-view>
  </div>
</div>