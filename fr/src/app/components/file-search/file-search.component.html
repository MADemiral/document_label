<div class="retro-search-container">
  
  <!-- Terminal Search Header -->
  <div class="search-terminal-window">
    <!-- Window Chrome -->
    <div class="terminal-window-chrome">
      <div class="window-controls">
        <span class="control minimize">-</span>
        <span class="control maximize">□</span>
        <span class="control close">×</span>
      </div>
      <div class="window-title">
        <span class="title-text">[DOCUMENT_SEARCH.EXE]</span>
        <span class="status-led" [class.active]="isSearching()"></span>
      </div>
    </div>

    <!-- Command Line Interface -->
    <div class="terminal-cli">
      <div class="cli-header">
        <span class="system-prompt">SEARCH&gt;</span>
        <span class="system-status">{{ isSearching() ? 'PROCESSING...' : 'READY' }}</span>
        <span class="cursor-blink">█</span>
      </div>

      <!-- Search Input Terminal -->
      <div class="search-input-terminal">
        <div class="input-line">
          <span class="input-prompt">QUERY&gt;</span>
          <input
            type="text"
            class="terminal-input"
            [placeholder]="placeholder"
            [value]="searchQuery()"
            (input)="onSearchInput($event)"
            (focus)="onInputFocus()"
            (blur)="onInputBlur()"
            (keydown)="onSearchKeyDown($event)"
          />
          <div class="input-actions">
            <button 
              class="terminal-btn search-btn"
              (click)="performManualSearch()"
              [disabled]="isSearching()">
              <span *ngIf="!isSearching()">🔍</span>
              <span *ngIf="isSearching()" class="spinning">⟳</span>
            </button>
            <button 
              class="terminal-btn clear-btn"
              *ngIf="searchQuery()"
              (click)="clearSearch()">
              <span>✗</span>
            </button>
          </div>
        </div>

        <!-- Character Hint Terminal -->
        <div class="hint-terminal" *ngIf="showCharacterHint()">
          <span class="hint-prompt">INFO&gt;</span>
          <span class="hint-text">{{ getCharacterHintText() }}</span>
          <span class="warning-icon">⚠</span>
        </div>

        <!-- Suggestions Terminal -->
        <div class="suggestions-terminal" *ngIf="showSuggestions()">
          <div class="suggestions-header">
            ┌─── LABEL SUGGESTIONS ───┐
            │ Found {{ suggestions().length }} matches │
            └─────────────────────────┘
          </div>
          <div class="suggestions-list">
            <div 
              class="suggestion-item"
              *ngFor="let suggestion of suggestions(); let i = index"
              [class.active]="i === activeSuggestionIndex()"
              (click)="selectSuggestion(suggestion)"
              (mouseenter)="activeSuggestionIndex.set(i)">
              <span class="suggestion-index">[{{i+1}}]</span>
              <span class="suggestion-icon">🏷</span>
              <span class="suggestion-name" [innerHTML]="highlightMatch(suggestion.name, searchQuery())"></span>
              <span class="suggestion-arrow">→</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Control Panel Terminal -->
      <div class="control-panel-terminal">
        <!-- Search Type Selector -->
        <div class="control-group" *ngIf="enableAdvancedSearch">
          <span class="control-label">MODE:</span>
          <select 
            class="terminal-select"
            [value]="searchType()"
            (change)="onSearchTypeChange($event)">
            <option value="semantic">[SEMANTIC]</option>
            <option value="label">[LABEL]</option>
          </select>
        </div>

        <!-- Advanced Filters Toggle -->
        <div class="control-group" *ngIf="enableAdvancedSearch">
          <button 
            class="terminal-toggle-btn"
            (click)="toggleAdvancedFilters()"
            [class.active]="showAdvancedFilters()">
            <span class="btn-icon">{{ showAdvancedFilters() ? '▼' : '▶' }}</span>
            <span class="btn-text">FILTERS</span>
          </button>
        </div>
      </div>

      <!-- Advanced Filters Terminal -->
      <div class="filters-terminal" *ngIf="showAdvancedFilters()">
        <div class="filters-border">
          ╔═════════════ ADVANCED FILTERS ══════════════╗
          ║                                              ║
          ╚══════════════════════════════════════════════╝
        </div>
        
        <div class="filters-grid">
          <div class="filter-terminal">
            <span class="filter-label">TYPE:</span>
            <select 
              class="terminal-select filter-select"
              [value]="selectedFileType()"
              (change)="onFileTypeChange($event)">
              <option value="all">[ALL]</option>
              <option *ngFor="let type of fileTypes.slice(1)" [value]="type">
                [{{ type.toUpperCase() }}]
              </option>
            </select>
          </div>

          <div class="filter-terminal">
            <span class="filter-label">CATEGORY:</span>
            <select 
              class="terminal-select filter-select"
              [value]="selectedCategory()"
              (change)="onCategoryChange($event)">
              <option value="all">[ALL]</option>
              <option *ngFor="let category of categories().slice(1)" [value]="category">
                [{{ category.toUpperCase() }}]
              </option>
            </select>
          </div>

          <div class="filter-terminal">
            <span class="filter-label">FROM:</span>
            <input 
              type="date"
              class="terminal-input filter-input"
              [value]="getStartDateValue()"
              (change)="onStartDateChange($event)">
          </div>

          <div class="filter-terminal">
            <span class="filter-label">TO:</span>
            <input 
              type="date"
              class="terminal-input filter-input"
              [value]="getEndDateValue()"
              (change)="onEndDateChange($event)">
          </div>
        </div>

        <div class="filters-actions">
          <button 
            class="terminal-btn clear-filters-btn"
            (click)="clearFilters()"
            [disabled]="!hasActiveFilters()">
            <span>🗑</span>
            <span>CLEAR_FILTERS</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Terminal Header -->
  <div class="results-terminal-header" *ngIf="totalResults() > 0">
    <div class="results-display">
      <div class="results-banner">
        ╔═══════════════ SEARCH RESULTS ═══════════════╗
        ║ {{ totalResults() }} DOCUMENTS FOUND          ║
        ║ SEARCH TIME: {{ searchTime() }}ms             ║
        ║ TYPE: {{ getSearchTypeText().toUpperCase() }}  ║
        ╚═══════════════════════════════════════════════╝
      </div>
    </div>

    <!-- View Controls Terminal -->
    <div class="view-controls-terminal">
      <!-- View Mode -->
      <div class="control-group">
        <span class="control-label">VIEW:</span>
        <div class="mode-buttons">
          <button 
            class="mode-btn"
            [class.active]="viewMode() === 'cards'"
            (click)="setViewMode('cards')"
            title="Cards View">
            <span>⊞</span>
          </button>
          <button 
            class="mode-btn"
            [class.active]="viewMode() === 'grid'"
            (click)="setViewMode('grid')"
            title="Grid View">
            <span>▦</span>
          </button>
          <button 
            class="mode-btn"
            [class.active]="viewMode() === 'list'"
            (click)="setViewMode('list')"
            title="List View">
            <span>☰</span>
          </button>
        </div>
      </div>

      <!-- Sort Controls -->
      <div class="control-group">
        <span class="control-label">SORT:</span>
        <select 
          class="terminal-select sort-select"
          [value]="sortBy()"
          (change)="onSortByChange($event)">
          <option value="relevance">[RELEVANCE]</option>
          <option value="date">[DATE]</option>
          <option value="name">[NAME]</option>
          <option value="size">[SIZE]</option>
        </select>
        
        <button 
          class="terminal-btn sort-order-btn"
          (click)="toggleSortOrder()">
          <span>{{ sortOrder() === 'asc' ? '↑' : '↓' }}</span>
        </button>
      </div>

      <!-- Preview Toggle -->
      <div class="control-group">
        <button 
          class="terminal-toggle-btn preview-btn"
          [class.active]="showPreview()"
          (click)="togglePreview()">
          <span>👁</span>
          <span>PREVIEW</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Search Results Terminal -->
  <div class="search-results-terminal" *ngIf="!isSearching() && totalResults() > 0">
    
    <!-- Cards View Terminal -->
    <div class="results-cards-terminal" *ngIf="viewMode() === 'cards'">
      <div class="document-cards-grid">
        <div 
          class="document-card-terminal"
          *ngFor="let document of documents(); trackBy: trackByDocumentId"
          (click)="openDocumentView(document)">
          
          <!-- Card Header -->
          <div class="card-terminal-header">
            <div class="card-chrome">
              <span class="card-controls">
                <span class="card-btn minimize">-</span>
                <span class="card-btn maximize">□</span>
                <span class="card-btn close">×</span>
              </span>
              <span class="card-title">DOC_{{ document.document_id }}</span>
            </div>
            
            <div class="card-info-display">
              <div class="info-line">
                <span class="info-label">FILE:</span>
                <span class="info-value">{{ document.title }}</span>
              </div>
              <div class="info-line" *ngIf="document.score">
                <span class="info-label">SCORE:</span>
                <span class="info-value score-display" [class]="getScoreClass(document.score)">
                  {{ (document.score * 100).toFixed(0) }}%
                </span>
              </div>
              <div class="info-line">
                <span class="info-label">SIZE:</span>
                <span class="info-value">{{ getContentStats(document) }}</span>
              </div>
            </div>
          </div>

          <!-- Preview Terminal -->
          <div class="card-preview-terminal" *ngIf="showPreview()">
            <div class="preview-border">
              ┌─── DOCUMENT PREVIEW ───┐
              │                        │
              └────────────────────────┘
            </div>
            <div class="preview-content">
              <div class="preview-text" *ngIf="document.summary">
                {{ getTruncatedSummary(document) }}
              </div>
              <div class="preview-text alt" *ngIf="!document.summary && document.content">
                {{ getTruncatedContent(document) }}
              </div>
            </div>
          </div>

          <!-- Labels Terminal -->
          <div class="card-labels-terminal" *ngIf="document.labels?.length > 0">
            <div class="labels-header">
              <span class="labels-prompt">TAGS&gt;</span>
              <span class="labels-count">[{{ document.labels.length }}]</span>
            </div>
            <div class="labels-list">
              <span 
                class="label-chip-terminal"
                *ngFor="let labelName of getVisibleLabels(document); let i = index"
                [class.highlighted]="isLabelHighlighted(labelName)"
                (click)="onLabelClick(labelName, $event)">
                🏷{{ labelName }}
              </span>
              <span class="more-labels-chip" *ngIf="document.labels.length > 3">
                +{{ document.labels.length - 3 }}
              </span>
            </div>
          </div>

          <!-- Card Footer Terminal -->
          <div class="card-footer-terminal">
            <div class="footer-info">
              <span class="footer-item" *ngIf="document.created_at">
                📅 {{ formatDate(document.created_at) }}
              </span>
              <span class="footer-item" *ngIf="document.search_type">
                🔍 {{ getSearchTypeText() }}
              </span>
            </div>
            
            <div class="footer-actions">
              <button 
                class="footer-btn"
                (click)="openDocumentView(document); $event.stopPropagation()"
                title="View">
                👁
              </button>
              <button 
                class="footer-btn"
                (click)="copyDocumentContent(document); $event.stopPropagation()"
                title="Copy">
                📋
              </button>
              <button 
                class="footer-btn"
                (click)="shareDocument(document); $event.stopPropagation()"
                title="Share">
                📤
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- List View Terminal -->
    <div class="results-list-terminal" *ngIf="viewMode() === 'list'">
      <div class="list-header-terminal">
        ╔═══╤═══════════════════════════════════════╤═══════╤═══════╗
        ║ # │ DOCUMENT                              │ SCORE │ ACTION║
        ╠═══╪═══════════════════════════════════════╪═══════╪═══════╣
      </div>
      
      <div class="document-list-terminal">
        <div 
          class="list-item-terminal"
          *ngFor="let document of documents(); let i = index; trackBy: trackByDocumentId"
          (click)="openDocumentView(document)">
          
          <div class="list-item-content">
            <span class="item-number">{{ (i + 1).toString().padStart(2, '0') }}</span>
            <span class="item-separator">│</span>
            
            <div class="item-details">
              <div class="item-title-line">
                <span class="item-icon">{{ getDocumentTypeChar(document) }}</span>
                <span class="item-title">{{ document.title }}</span>
              </div>
              <div class="item-summary-line" *ngIf="document.summary">
                <span class="summary-text" [innerHTML]="getTruncatedSummary(document)"></span>
              </div>
              <div class="item-meta-line">
                <span class="meta-item">ID:{{ document.document_id }}</span>
                <span class="meta-separator">│</span>
                <span class="meta-item">{{ getContentStats(document) }}</span>
                <span class="meta-separator">│</span>
                <span class="meta-item" *ngIf="document.created_at">{{ formatDate(document.created_at) }}</span>
              </div>
            </div>
            
            <span class="item-separator">│</span>
            
            <div class="item-score" *ngIf="document.score">
              <span class="score-bar" [class]="getScoreClass(document.score)">
                {{ (document.score * 100).toFixed(0) }}%
              </span>
            </div>
            
            <span class="item-separator">│</span>
            
            <div class="item-actions">
              <button 
                class="action-btn"
                (click)="openDocumentView(document); $event.stopPropagation()"
                title="Open">
                ▶
              </button>
            </div>
          </div>
          
          <!-- Labels Line -->
          <div class="item-labels-line" *ngIf="document.labels?.length > 0">
            <span class="labels-prefix">    TAGS&gt;</span>
            <span 
              class="label-mini-terminal"
              *ngFor="let label of getVisibleLabels(document)"
              [class.highlighted]="isLabelHighlighted(label)">
              [{{ label }}]
            </span>
          </div>
        </div>
      </div>
      
      <div class="list-footer-terminal">
        ╚═══════════════════════════════════════════════════════════╝
      </div>
    </div>

    <!-- Grid View Terminal -->
    <div class="results-grid-terminal" *ngIf="viewMode() === 'grid'">
      <div class="document-grid-terminal">
        <div 
          class="grid-item-terminal"
          *ngFor="let document of documents(); trackBy: trackByDocumentId"
          (click)="openDocumentView(document)">
          
          <div class="grid-item-border">
            ┌─────────────────┐
            │                 │
            └─────────────────┘
          </div>
          
          <div class="grid-item-content">
            <div class="grid-item-icon">
              {{ getDocumentTypeChar(document) }}
            </div>
            
            <div class="grid-item-title">{{ document.title }}</div>
            
            <div class="grid-item-info">
              <span class="grid-stats">{{ getContentStats(document) }}</span>
              <span class="grid-score" *ngIf="document.score" [class]="getScoreClass(document.score)">
                {{ (document.score * 100).toFixed(0) }}%
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Terminal -->
  <div class="loading-terminal" *ngIf="isSearching()">
    <div class="loading-border">
      ╔════════════════════════════════════╗
      ║          SEARCHING...              ║
      ║                                    ║
      ║    ⠋ Processing documents...       ║
      ║                                    ║
      ╚════════════════════════════════════╝
    </div>
    <div class="loading-progress">
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
      <div class="loading-text">Please wait...</div>
    </div>
  </div>

  <!-- Empty Terminal -->
  <div class="empty-terminal" *ngIf="!isSearching() && totalResults() === 0 && searchQuery()">
    <div class="empty-border">
      ╔════════════════════════════════════╗
      ║            NO RESULTS              ║
      ║                                    ║
      ║     🔍 No documents found          ║
      ║                                    ║
      ║     Query: "{{ searchQuery() }}"   ║
      ║                                    ║
      ╚════════════════════════════════════╝
    </div>
    <div class="empty-actions">
      <button class="terminal-btn clear-search-btn" (click)="clearSearch()">
        <span>✗</span>
        <span>CLEAR_SEARCH</span>
      </button>
    </div>
  </div>

  <!-- Status Messages Terminal -->
  <div class="messages-terminal" *ngIf="saveSuccess() || saveError()">
    <div class="message-success" *ngIf="saveSuccess()">
      <span class="message-prompt">OK&gt;</span>
      <span class="message-text">{{ saveSuccess() }}</span>
      <span class="message-icon">✓</span>
    </div>
    <div class="message-error" *ngIf="saveError()">
      <span class="message-prompt">ERR&gt;</span>
      <span class="message-text">{{ saveError() }}</span>
      <span class="message-icon">✗</span>
    </div>
  </div>

  <!-- Terminal Scan Lines Effect -->
  <div class="terminal-scanlines"></div>
</div>

<!-- FILE VIEW MODAL TERMINAL -->
<div class="file-view-terminal-overlay" *ngIf="showFileView()" (click)="closeFileView()">
  <div class="file-view-terminal-modal" (click)="$event.stopPropagation()">
    <app-file-view
      [document]="selectedDocument()!"
      [isModal]="isFileViewModal()"
      [searchQuery]="searchQuery()"
      (closeView)="closeFileView()"
      (editDocument)="onFileViewEditDocument($event)"
      (deleteDocument)="onFileViewDeleteDocument($event)"
      (downloadDocument)="onFileViewDownloadDocument($event)"
      (shareDocument)="onFileViewShareDocument($event)"
      (labelClick)="onFileViewLabelClick($event)">
    </app-file-view>
  </div>
</div>